version: 0.2

env:
  variables:
    GO_VERSION: 1.19

phases:
  install:
    commands:      
      - echo "in the install phase"
      - wget https://storage.googleapis.com/golang/go${GO_VERSION}.linux-amd64.tar.gz
      - tar -C /usr/local -xzf go${GO_VERSION}.linux-amd64.tar.gz
      - export PATH="/usr/local/go/bin:$PATH" && export GOPATH="$HOME/go" && export PATH="$GOPATH/bin:$PATH"
      # install govulncheck to scan code
      - echo install govulncheck
      - go install golang.org/x/vuln/cmd/govulncheck@latest   
  pre-build:
    commands:
      # Vulnerability detection using govulncheck
      - which govulncheck
      - echo trying to execute govulncheck on project
      - govulncheck -json ./... > govulncheck-scan-results.json
  build:
    commands:
      - echo Build started on `date`
      - go build -o ./ceai ./cmd/cli
      - echo gopath $GOPATH
  post_build:
    commands:
      - echo Build completed on `date`
      - echo list of elements before ending process
      - ls -la   
artifacts:
  files:
    - govulncheck-scan-results.json